<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ryan City FPS</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }

#menu{
position:absolute;
width:100%;
height:100%;
background:black;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
color:white;
z-index:10;
}

#menu button{
padding:15px 40px;
font-size:20px;
cursor:pointer;
}

#crosshair{
position:absolute;
top:50%;
left:50%;
width:12px;
height:12px;
margin-left:-6px;
margin-top:-6px;
border:2px solid white;
border-radius:50%;
display:none;
}

#healthUI{
position:absolute;
top:10px;
left:10px;
color:white;
display:none;
}
</style>
</head>
<body>

<div id="menu">
<h1>RYAN CITY FPS</h1>
<button onclick="startGame()">START</button>
</div>

<div id="crosshair"></div>
<div id="healthUI">Health: <span id="health">100</span></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls;
let enemies=[];
let move={w:false,a:false,s:false,d:false};
let shooting=false;
let health=100;
let gun, muzzleFlash;
let recoil=0;
let walkTime=0;
let gameStarted=false;

function init(){

scene=new THREE.Scene();
scene.background=new THREE.Color(0x0a0a0f);
scene.fog=new THREE.Fog(0x000000,50,200);

camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.y=2;

renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled=true;
document.body.appendChild(renderer.domElement);

// LIGHTING
let light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(50,100,50);
light.castShadow=true;
scene.add(light);

let ambient=new THREE.AmbientLight(0x404040);
scene.add(ambient);

// FLOOR
let floorGeo=new THREE.PlaneGeometry(500,500);
let floorMat=new THREE.MeshStandardMaterial({color:0x1a1a1a});
let floor=new THREE.Mesh(floorGeo,floorMat);
floor.rotation.x=-Math.PI/2;
floor.receiveShadow=true;
scene.add(floor);

// CITY BUILDINGS
for(let i=0;i<60;i++){
let height=Math.random()*20+10;
let geo=new THREE.BoxGeometry(10,height,10);
let mat=new THREE.MeshStandardMaterial({color:0x333344});
let building=new THREE.Mesh(geo,mat);
building.position.set(
Math.random()*400-200,
height/2,
Math.random()*400-200
);
building.castShadow=true;
building.receiveShadow=true;
scene.add(building);
}

// CONTROLS
controls=new THREE.PointerLockControls(camera,document.body);
scene.add(controls.getObject());

// ARMS
let armMat=new THREE.MeshStandardMaterial({color:0xffcc99});
let armGeo=new THREE.BoxGeometry(0.6,1.4,0.6);

let leftArm=new THREE.Mesh(armGeo,armMat);
leftArm.position.set(-1,-1.4,-2);

let rightArm=new THREE.Mesh(armGeo,armMat);
rightArm.position.set(1,-1.4,-2);

// GUN
let gunGeo=new THREE.BoxGeometry(0.6,0.5,2);
let gunMat=new THREE.MeshStandardMaterial({color:0x111111});
gun=new THREE.Mesh(gunGeo,gunMat);
gun.position.set(1,-1.5,-1.5);

// MUZZLE FLASH
let flashGeo=new THREE.SphereGeometry(0.3,16,16);
let flashMat=new THREE.MeshBasicMaterial({color:0xffaa00});
muzzleFlash=new THREE.Mesh(flashGeo,flashMat);
muzzleFlash.position.set(0,0,-1.2);
muzzleFlash.visible=false;
gun.add(muzzleFlash);

camera.add(leftArm);
camera.add(rightArm);
camera.add(gun);
scene.add(camera);

setInterval(spawnEnemy,2000);

animate();
}

function spawnEnemy(){
if(!gameStarted)return;

let geo=new THREE.BoxGeometry(2,2,2);
let mat=new THREE.MeshStandardMaterial({color:0xaa0000});
let enemy=new THREE.Mesh(geo,mat);
enemy.position.set(Math.random()*300-150,1,Math.random()*300-150);
enemy.castShadow=true;
scene.add(enemy);
enemies.push(enemy);
}

function startGame(){
document.getElementById("menu").style.display="none";
document.getElementById("crosshair").style.display="block";
document.getElementById("healthUI").style.display="block";
controls.lock();
gameStarted=true;
}

document.addEventListener("keydown",e=>{
if(e.code==="KeyW")move.w=true;
if(e.code==="KeyS")move.s=true;
if(e.code==="KeyA")move.a=true;
if(e.code==="KeyD")move.d=true;
});
document.addEventListener("keyup",e=>{
if(e.code==="KeyW")move.w=false;
if(e.code==="KeyS")move.s=false;
if(e.code==="KeyA")move.a=false;
if(e.code==="KeyD")move.d=false;
});

document.addEventListener("mousedown",()=>shooting=true);
document.addEventListener("mouseup",()=>shooting=false);

function shoot(){
let raycaster=new THREE.Raycaster();
raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
let hits=raycaster.intersectObjects(enemies);

if(hits.length>0){
scene.remove(hits[0].object);
enemies=enemies.filter(e=>e!==hits[0].object);
}

// recoil
recoil=0.15;

// muzzle flash
muzzleFlash.visible=true;
setTimeout(()=>muzzleFlash.visible=false,50);
}

function updateEnemies(){
enemies.forEach(enemy=>{
let dx=camera.position.x-enemy.position.x;
let dz=camera.position.z-enemy.position.z;
let dist=Math.sqrt(dx*dx+dz*dz);
enemy.position.x+=dx/dist*0.02;
enemy.position.z+=dz/dist*0.02;

if(dist<2){
health-=0.1;
document.getElementById("health").textContent=Math.floor(health);
}
});
}

function animate(){
requestAnimationFrame(animate);

let speed=0.2;
let moving=false;

if(move.w){controls.moveForward(speed);moving=true;}
if(move.s){controls.moveForward(-speed);moving=true;}
if(move.a){controls.moveRight(-speed);moving=true;}
if(move.d){controls.moveRight(speed);moving=true;}

// WALKING ANIMATION
if(moving){
walkTime+=0.1;
gun.position.y=-1.5+Math.sin(walkTime)*0.1;
}else{
gun.position.y=-1.5;
}

// recoil animation
if(recoil>0){
gun.position.z-=recoil;
recoil-=0.03;
}else{
gun.position.z=-1.5;
}

if(shooting)shoot();

updateEnemies();

if(health<=0){
alert("GAME OVER");
location.reload();
}

renderer.render(scene,camera);
}

init();
</script>
</body>
</html>
