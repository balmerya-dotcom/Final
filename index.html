<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ryan's 3D FPS</title>
<style>
body { margin: 0; overflow: hidden; background: black; }
#ui {
  position: absolute;
  top: 10px;
  left: 10px;
  color: white;
  font-family: Arial;
  font-size: 18px;
}
#crosshair {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 6px;
  height: 6px;
  margin-left: -3px;
  margin-top: -3px;
  background: white;
  border-radius: 50%;
}
</style>
</head>
<body>

<div id="ui">Health: <span id="health">100</span></div>
<div id="crosshair"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x101010);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.y = 2;

let renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// LIGHT
let light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
scene.add(light);

// FLOOR
let floorGeo = new THREE.PlaneGeometry(400, 400);
let floorMat = new THREE.MeshStandardMaterial({ color: 0x222222 });
let floor = new THREE.Mesh(floorGeo, floorMat);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// CONTROLS
let controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener("click", () => controls.lock());
scene.add(controls.getObject());

// MOVEMENT
let move = {w:false,a:false,s:false,d:false};

document.addEventListener("keydown", e=>{
  if(e.code==="KeyW") move.w=true;
  if(e.code==="KeyS") move.s=true;
  if(e.code==="KeyA") move.a=true;
  if(e.code==="KeyD") move.d=true;
});

document.addEventListener("keyup", e=>{
  if(e.code==="KeyW") move.w=false;
  if(e.code==="KeyS") move.s=false;
  if(e.code==="KeyA") move.a=false;
  if(e.code==="KeyD") move.d=false;
});

// ARMS
let armMat = new THREE.MeshStandardMaterial({color:0xffcc99});
let armGeo = new THREE.BoxGeometry(0.4,1,0.4);

let leftArm = new THREE.Mesh(armGeo,armMat);
leftArm.position.set(-0.6,-0.7,-1.5);

let rightArm = new THREE.Mesh(armGeo,armMat);
rightArm.position.set(0.6,-0.7,-1.5);

// GUN
let gunGeo = new THREE.BoxGeometry(0.4,0.3,1.2);
let gunMat = new THREE.MeshStandardMaterial({color:0x111111});
let gun = new THREE.Mesh(gunGeo,gunMat);
gun.position.set(0.6,-0.8,-1.2);

camera.add(leftArm);
camera.add(rightArm);
camera.add(gun);
scene.add(camera);

// ENEMIES
let enemies = [];

function spawnEnemy(){
  let geo = new THREE.BoxGeometry(2,2,2);
  let mat = new THREE.MeshStandardMaterial({color:0xff0000});
  let enemy = new THREE.Mesh(geo,mat);

  enemy.position.set(
    Math.random()*150-75,
    1,
    Math.random()*150-75
  );

  scene.add(enemy);
  enemies.push(enemy);
}

setInterval(spawnEnemy,2000);

// SHOOTING
let shooting=false;
document.addEventListener("mousedown",()=>shooting=true);
document.addEventListener("mouseup",()=>shooting=false);

function shoot(){
  let raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(new THREE.Vector2(0,0),camera);
  let hits = raycaster.intersectObjects(enemies);

  if(hits.length>0){
    scene.remove(hits[0].object);
    enemies = enemies.filter(e=>e!==hits[0].object);
  }
}

// ENEMY AI + DAMAGE
function updateEnemies(){
  enemies.forEach(enemy=>{
    let dx = camera.position.x - enemy.position.x;
    let dz = camera.position.z - enemy.position.z;
    let distance = Math.sqrt(dx*dx + dz*dz);

    enemy.position.x += dx/distance * 0.02;
    enemy.position.z += dz/distance * 0.02;

    if(distance < 2){
      health -= 0.1;
      document.getElementById("health").textContent = Math.floor(health);
    }
  });
}

// HEALTH
let health = 100;

// GAME LOOP
function animate(){
  requestAnimationFrame(animate);

  let speed=0.15;

  if(move.w) controls.moveForward(speed);
  if(move.s) controls.moveForward(-speed);
  if(move.a) controls.moveRight(-speed);
  if(move.d) controls.moveRight(speed);

  if(shooting) shoot();

  updateEnemies();

  if(health<=0){
    alert("GAME OVER");
    location.reload();
  }

  renderer.render(scene,camera);
}

animate();
</script>
</body>
</html>
